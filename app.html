<!DOCTYPE html>
<html lang="en">
<script type="module">
    import { supabase } from "/js/supabase.js";

    (async () => {
        const {
            data: { session },
        } = await supabase.auth.getSession();

        if (!session) {
            // No user â†’ go back to login
            window.location.href = "login.html";
        } else {
            console.log("User:", session.user);
        }
    })();
</script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AeroClub Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/png" href="pictures/AeroHandler_logo_square_transparent.png">
</head>

<body class="bg-gray-900 text-white">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-gray-800 shadow-md flex flex-col justify-between">
            <div>
                <div class="p-4 flex items-center border-b border-gray-700">
                    <img src="pictures/AeroHandler_logo_square.png" alt="AeroClub Logo"
                        class="w-10 h-10 rounded-md mr-2">
                    <a href="#dashboard" id="home-link"
                        class="font-semibold text-lg text-white hover:text-blue-400">AeroClub</a>
                </div>
                <nav class="p-4">
                    <ul class="space-y-2">
                        <li><a href="#dashboard" class="block p-2 rounded hover:bg-gray-700">Dashboard</a></li>
                        <li><a href="#submit_flight" class="block p-2 rounded hover:bg-gray-700">+ Submit Flight</a>
                        </li>
                        <li><a href="#students" class="block p-2 rounded hover:bg-gray-700"> Students</a></li>
                        <li><a href="#instructors" class="block p-2 rounded hover:bg-gray-700"> Instructors</a></li>
                        <li><a href="#members" class="block p-2 rounded hover:bg-gray-700"> Members</a></li>
                        <li><a href="#planes" class="block p-2 rounded hover:bg-gray-700"> Planes</a></li>
                        <li><a href="#bookings" class="block p-2 rounded hover:bg-gray-700"> Bookings</a></li>
                        <li><a href="#flight_logs" class="block p-2 rounded hover:bg-gray-700"> Flight Logs</a></li>
                        <li><a href="#finances" class="block p-2 rounded hover:bg-gray-700"> Finances</a></li>
                        <li><a href="#maintenance" class="block p-2 rounded hover:bg-gray-700"> Maintenance</a></li>
                        <li><a href="#staff" class="block p-2 rounded hover:bg-gray-700"> Staff</a></li>
                        <!-- <li><a href="#schedule" class="block p-2 rounded hover:bg-gray-700">Schedule</a></li> -->
                    </ul>
                </nav>
            </div>
            <div class="p-4 border-t border-gray-700">
                <a href="#settings" class="block p-2 rounded hover:bg-gray-700">Settings</a>
                <button id="logout-btn"
                    class="mt-2 px-3 py-1 bg-red-600 text-white rounded hover:bg-red-500 w-full">Logout</button>

                <script type="module">
                    import { supabase } from "/js/supabase.js";

                    document.getElementById("logout-btn").addEventListener("click", async () => {
                        await supabase.auth.signOut();
                        window.location.href = "login.html";
                    });
                </script>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 p-6 overflow-y-auto bg-gray-900 text-white">
            <!-- Default page loads here via JS -->
        </main>

        <div id="toast-container" class="fixed top-4 right-4 space-y-2 z-50"></div>
    </div>

    <!-- Supabase & Main JS -->
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
    <script type="module" src="./js/main.js"></script>

    <script>
        // Global error handler to catch any uncaught errors
        window.addEventListener('error', function (e) {
            console.error('Global error:', e.error);
        });

        // Handle any promise rejections
        window.addEventListener('unhandledrejection', function (e) {
            console.error('Unhandled promise rejection:', e.reason);
        });
    </script>
</body>

</html>